<!DOCTYPE html>
<html lang="en" class="light-style layout-menu-fixed" dir="ltr" data-theme="theme-default" data-assets-path="../assets/" data-template="vertical-menu-template-free">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0" />
    <title>Asset Management</title>
    <link rel="icon" type="image/x-icon" href="../assets/img/favicon/favicon.ico" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Public+Sans:ital,wght@0,300;0,400;0,500;0,600;0,700;1,300;1,400;1,500;1,600;1,700&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="../assets/vendor/fonts/boxicons.css" />
    <link rel="stylesheet" href="../assets/vendor/css/core.css" class="template-customizer-core-css" />
    <link rel="stylesheet" href="../assets/vendor/css/theme-default.css" class="template-customizer-theme-css" />
    <link rel="stylesheet" href="../assets/css/demo.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />
    <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
    <link rel="stylesheet" href="../assets/vendor/libs/perfect-scrollbar/perfect-scrollbar.css" />
    <script src="../assets/vendor/js/helpers.js"></script>
    <script src="../assets/js/config.js"></script>

    <!-- AutoComplete.js -->
    <script src="https://cdn.jsdelivr.net/npm/@tarekraafat/autocomplete.js@10.2.7/dist/autoComplete.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@tarekraafat/autocomplete.js@10.2.7/dist/css/autoComplete.min.css">

    <style>
      /* Ticker */
      #topMoversSlider { display: flex; gap: 20px; padding: 5px 0; width: 100%; white-space: nowrap; overflow: hidden; position: relative; background: #fff; border-radius: 6px; }
      .mover-track { display: inline-flex; animation: scrollTicker linear infinite; }
      .mover-card { min-width: 140px; padding: 6px 12px; border-radius: 6px; text-align: center; background: #f5f5f5; box-shadow: 0 2px 4px rgba(0,0,0,0.08); flex-shrink: 0; margin-right: 18px; font-size: 14px; font-weight: 500; }
      .mover-card.up { background: #e6f9ee; }
      .mover-card.up small { color: #0f9d58; }
      .mover-card.down { background: #fdecea; }
      .mover-card.down small { color: #d93025; }
      #topMoversSlider:hover .mover-track { animation-play-state: paused; }
      .tickerSwiper .swiper-slide { display: flex; align-items: center; font-size: 14px; white-space: nowrap; }
      @keyframes scrollTicker { 0% { transform: translateX(0); } 100% { transform: translateX(-50%); } }

      /* AutoComplete style */
      .autoComplete_wrapper { display:block; width:100%; }
      .autoComplete_wrapper > input#assetSearch.form-control { width: 100%; border: 1px solid #d9dee3; border-radius: 0.375rem; background-color: #fff; padding: 0.5rem 0.75rem; font-size: 0.9375rem; color: #495057 !important; box-shadow: none; } 
      .autoComplete_wrapper .autoComplete_results_list { margin-top: .25rem; border: 1px solid #d9dee3; border-radius: .375rem; background: #fff; box-shadow: 0 4px 8px rgba(0,0,0,.05); max-height: 280px; overflow-y: auto; padding: .25rem 0; }
      #assetSearch::placeholder { color: #888; opacity: 1; }
      #assetSearch { background-image: none !important; }
      .autoComplete_wrapper .autoComplete_result { padding: .5rem .75rem; cursor: pointer; font-size: .9375rem; }
      .autoComplete_wrapper .autoComplete_result:hover, .autoComplete_wrapper .autoComplete_result[aria-selected="true"] { background: #f5f5f9; }
      .autoComplete_highlighted { background: transparent; color: inherit; font-weight: 600; text-decoration: underline; }
      .autoComplete_wrapper .autoComplete_icon { display: none !important; }
    </style>
  </head>

  <body>
    <div class="layout-wrapper layout-content-navbar">
      <div class="layout-container">
        <!-- Sidebar -->
        <aside id="layout-menu" class="layout-menu menu-vertical menu bg-menu-theme">
          <div class="app-brand demo">
            <a href="index.html" class="app-brand-link">
              <span class="app-brand-logo demo">Sneat</span>
              <span class="app-brand-text demo menu-text fw-bolder ms-2">Sneat</span>
            </a>
            <a href="javascript:void(0);" class="layout-menu-toggle menu-link text-large ms-auto d-block d-xl-none">
              <i class="bx bx-chevron-left bx-sm align-middle"></i>
            </a>
          </div>
          <div class="menu-inner-shadow"></div>
          <ul class="menu-inner py-1">
            <li class="menu-item">
              <a href="index.html" class="menu-link">
                <i class="menu-icon tf-icons bx bx-home-circle"></i>
                <div data-i18n="Analytics">Dashboard</div>
              </a>
            </li>
            <li class="menu-header small text-uppercase"><span class="menu-header-text">Components</span></li>
            <li class="menu-item active">
              <a href="assets-list.html" class="menu-link">
                <i class="menu-icon tf-icons bx bx-table"></i>
                <div data-i18n="Tables">Manage portfolio</div>
              </a>
            </li>
            <li class="menu-item">
              <a href="assets.html" class="menu-link">
                <i class="menu-icon tf-icons bx bx-collection"></i>
                <div data-i18n="Tables">Assets</div>
              </a>
            </li>
          </ul>
        </aside>

        <!-- Main layout -->
        <div class="layout-page">
          <nav class="layout-navbar container-xxl navbar navbar-expand-xl navbar-detached align-items-center bg-navbar-theme" id="layout-navbar">
            <div class="layout-menu-toggle navbar-nav align-items-xl-center me-3 me-xl-0 d-xl-none">
              <a class="nav-item nav-link px-0 me-xl-4" href="javascript:void(0)"><i class="bx bx-menu bx-sm"></i></a>
            </div>
            <div class="navbar-nav-right d-flex align-items-center" id="navbar-collapse">
              <div class="navbar-nav align-items-center w-100">
                <div class="nav-item d-flex align-items-center w-100">
                  <div id="topMoversSlider" style="width:100%; max-width:1300px;"></div>
                </div>
              </div>
              <ul class="navbar-nav flex-row align-items-center ms-auto"></ul>
            </div>
          </nav>

          <div class="content-wrapper">
            <div class="container-xxl flex-grow-1 container-p-y">
              <h4 class="fw-bold py-3 mb-4"><span class="text-muted fw-light">Portfolio Management /</span> Transactions</h4>

              <!-- Transactions table -->
              <div class="card">
                <h5 class="card-header">Manage transactions</h5>
                <div class="table-responsive text-nowrap">
                  <table class="table">
                    <thead>
                      <tr>
                        <th>Item</th>
                        <th>Price</th>
                        <th>Amount</th>
                        <th>Date</th>
                        <th>Type</th>
                        <th>Trade Type</th>
                        <th>Actions</th>
                      </tr>
                    </thead>
                    <tbody class="table-border-bottom-0">
                      <tr>
                        <td><strong>AAPL</strong></td>
                        <td>100</td>
                        <td>2</td>
                        <td>08/22/2025</td>
                        <td>Stock</td>
                        <td>BUY</td>
                        <td>
                          <div class="dropdown">
                            <button type="button" class="btn p-0 dropdown-toggle hide-arrow" data-bs-toggle="dropdown">
                              <i class="bx bx-dots-vertical-rounded"></i>
                            </button>
                            <div class="dropdown-menu">
                              <a class="dropdown-item" href="#"><i class="bx bx-edit-alt me-1"></i> Edit</a>
                              <a class="dropdown-item" href="#"><i class="bx bx-trash me-1"></i> Delete</a>
                            </div>
                          </div>
                        </td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>

              <hr class="my-5" />

              <!-- Transaction form -->
              <div class="col-xxl">
                <div class="card mb-4">
                  <div class="card-header d-flex align-items-center justify-content-between">
                    <h5 class="mb-0">Add transaction</h5>
                  </div>
                  <div class="card-body">
                    <form id="transactionForm">
                      <!-- Asset Search -->
                      <div class="row mb-3">
                        <label class="col-sm-2 col-form-label" for="assetSearch">Asset</label>
                        <div class="col-sm-10">
                          <input id="assetSearch" type="text" class="form-control" placeholder="Search Tesla, BTC, EUR/USD..." autocomplete="off" />
                          <input type="hidden" id="assetSymbol" />
                        </div>
                      </div>

                      <!-- Asset Type -->
                      <div class="row mb-3">
                        <label class="col-sm-2 col-form-label" for="asset-type">Type</label>
                        <div class="col-sm-10">
                          <input type="text" class="form-control asset-type-input" id="asset-type" placeholder="Auto filled from dropdown" readonly required />
                        </div>
                      </div>

                      <!-- Trade Type -->
                      <div class="row mb-3">
                        <label class="col-sm-2 col-form-label" for="tradeType">Trade Type</label>
                        <div class="col-sm-10">
                          <select class="form-select" id="tradeType" required>
                            <option value="" disabled selected>Select trade type</option>
                            <option value="BUY">BUY</option>
                            <option value="SELL">SELL</option>
                          </select>
                        </div>
                      </div>

                      <!-- Price with button -->
                      <div class="row mb-3">
                        <label class="col-sm-2 col-form-label" for="price">Price</label>
                        <div class="col-sm-10 d-flex">
                          <input type="number" step="0.0001" class="form-control" id="price" placeholder="Insert price" />
                          <button type="button" id="getPriceBtn" class="btn btn-outline-secondary ms-2">Get Current Price</button>
                        </div>
                      </div>

                      <!-- Amount -->
                      <div class="row mb-3">
                        <label class="col-sm-2 col-form-label" for="amount">Amount</label>
                        <div class="col-sm-10">
                          <input type="number" min="0" step="0.0001" class="form-control" id="amount" placeholder="Insert amount" />
                        </div>
                      </div>

                      <!-- Date -->
                      <div class="row mb-3">
                        <label class="col-sm-2 col-form-label" for="date">Date</label>
                        <div class="col-sm-10">
                          <input type="date" class="form-control" id="date" />
                        </div>
                      </div>

                      <!-- Submit -->
                      <div class="row justify-content-end">
                        <div class="col-sm-10">
                          <button type="submit" class="btn btn-primary">Add</button>
                        </div>
                      </div>
                    </form>
                  </div>
                </div>
              </div>

            </div>

            <footer class="content-footer footer bg-footer-theme"></footer>
            <div class="content-backdrop fade"></div>
          </div>
        </div>
      </div>
      <div class="layout-overlay layout-menu-toggle"></div>
    </div>

    <!-- JS -->
    <script src="../assets/vendor/libs/jquery/jquery.js"></script>
    <script src="../assets/vendor/libs/popper/popper.js"></script>
    <script src="../assets/vendor/js/bootstrap.js"></script>
    <script src="../assets/vendor/libs/perfect-scrollbar/perfect-scrollbar.js"></script>
    <script src="../assets/vendor/js/menu.js"></script>
    <script src="../assets/js/main.js"></script>
    <script async defer src="https://buttons.github.io/buttons.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

    <script>
      const apiKey = "dc33e0352a1e470b851a62184ed8bf70";
      let selectedSymbol = null;

      // Set default date = today
      (function setToday() {
        const d = document.getElementById("date");
        if (d && !d.value) {
          const today = new Date();
          const yyyy = today.getFullYear();
          const mm = String(today.getMonth()+1).padStart(2,"0");
          const dd = String(today.getDate()).padStart(2,"0");
          d.value = `${yyyy}-${mm}-${dd}`;
        }
      })();

      // Clear selection if input no longer matches selected symbol
      document.getElementById("assetSearch").addEventListener("input", (e) => {
        if (selectedSymbol && !e.target.value.startsWith(selectedSymbol)) {
          selectedSymbol = null;
          document.getElementById("assetSymbol").value = "";
          document.getElementById("assetType").value = "";
        }
      });

      // ===== Autocomplete =====
      const ac = new autoComplete({
        selector: "#assetSearch",
        placeHolder: "Search Tesla, BTC, EUR/USD...",
        threshold: 2,
        showIcon: false,
        data: {
          src: async (query) => {
            try {
              const { data } = await axios.get(`https://api.twelvedata.com/symbol_search?symbol=${encodeURIComponent(query)}&apikey=${apiKey}`);
              return Array.isArray(data?.data) ? data.data : [];
            } catch {
              return [];
            }
          },
          keys: ["symbol", "instrument_name", "name"]
        },
        resultsList: { render: true },
        resultItem: {
          highlight: true,
          element: (item, data) => {
            const v = data.value || {};
            const sym = v.symbol || "";
            const name = v.instrument_name || v.name || sym;
            const type = v.instrument_type || v.asset_class || "Unknown";
        
            // Store full object as JSON string
            item.setAttribute("data-value", JSON.stringify(v));
        
            item.innerHTML = `<div><strong>${sym}</strong> - ${name} <small>[${type}]</small></div>`;
          }
        },

        
        
        
      });

      // ===== Fetch Quote =====
      async function fetchQuote(symbol) {
        try {
          const { data } = await axios.get(`https://api.twelvedata.com/quote?symbol=${encodeURIComponent(symbol)}&apikey=${apiKey}`);
          return data || {};
        } catch { return {}; }
      }

      document.getElementById("getPriceBtn").addEventListener("click", async () => {
        if (!selectedSymbol) { alert("Please select an asset first."); return; }
        const q = await fetchQuote(selectedSymbol);
        const price = q?.close ?? q?.price ?? q?.last ?? null;
        if (price != null && !isNaN(price)) {
          document.getElementById("price").value = parseFloat(price).toFixed(4);
        } else { alert("Price not available for this symbol."); }
      });

      // ===== Submit =====
      document.getElementById("transactionForm").addEventListener("submit", (e) => {
        e.preventDefault();
        const payload = {
          asset: document.getElementById("assetSymbol").value,
          type: document.getElementById("assetType").value,
          tradeType: document.getElementById("tradeType").value,
          price: parseFloat(document.getElementById("price").value),
          amount: parseFloat(document.getElementById("amount").value),
          date: document.getElementById("date").value,
        };
        console.log("Submitted:", payload);
        alert("Form submitted! (See console)");
      });

      // ===== Top movers ticker =====
      async function fetchTopMovers() {
        try {
          const resp = await fetch(`https://api.twelvedata.com/stocks?apikey=${apiKey}&country=United%20States`);
          const list = await resp.json();
          const symbols = Array.isArray(list?.data) ? list.data.slice(0, 15).map(s => s.symbol) : [];
          const quotes = await Promise.all(symbols.map(fetchQuote));
          return symbols.map((sym,i)=>{ const q=quotes[i]||{}; return { symbol:sym, price:q?.close??q?.price??"N/A", change:q?.percent_change??0 }; });
        } catch { return []; }
      }

      function createTickerItems(items) {
        return items.map(item => {
          let color = parseFloat(item.change) > 0 ? "green" : parseFloat(item.change) < 0 ? "red" : "black";
          return `<div class="swiper-slide"><span style="font-weight:bold;">${item.symbol}</span><span style="margin:0 6px;">$${item.price}</span><span style="color:${color};">${item.change}%</span></div>`;
        }).join("");
      }

      async function initTicker() {
        const movers = await fetchTopMovers();
        document.querySelector("#topMoversSlider").innerHTML = `<div class="swiper tickerSwiper"><div class="swiper-wrapper">${createTickerItems(movers)}</div></div>`;
        new Swiper(".tickerSwiper", {
          slidesPerView: 5, spaceBetween: 40, loop: true, speed: 6000,
          autoplay: { delay: 0, disableOnInteraction: false, pauseOnMouseEnter: true },
        });
      }
      initTicker();
    </script>
  </body>
</html>
